<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>D√©couvrez des id√©es de prompts</title>
    <meta name="theme-color" content="#010132">
    <link rel="manifest" href="manifest.json">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;700;800&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Montserrat', sans-serif;
        }

        /* --- Custom Select --- */
        .select-arrow {
            transition: transform 0.3s ease;
        }
        .select-arrow-up {
            transform: rotate(180deg);
        }

        /* --- Loading Text Animation --- */
        #loading-text {
            transition: opacity 0.5s ease-in-out;
        }
        #loading-text.is-fading {
            opacity: 0;
        }
        
        #history-panel {
            /* On positionne la liste par rapport √† son parent, #main-panel */
            position: absolute;
            /* Aligne parfaitement la liste SOUS le texte du d√©clencheur */
            top: 4.5rem; 
            /* Aligne la gauche de la liste √† 1rem de la bordure droite du panneau principal */
            left: calc(100% + 2rem); 
            width: 50%;
            /* √âtat initial pour l'animation (cach√©) */
            opacity: 0;
            max-height: 0;
            overflow: hidden;
            /* Transition douce pour l'apparition */
            transition: max-height 0.6s ease-in-out, opacity 0.5s ease-in-out;
        }

        /* On conserve le d√©calage du panneau principal */
        body.history-open #main-panel {
            transform: translateX(-150px);
        }

        /* √âtat final pour l'animation (visible) */
        body.history-open #history-panel {
            opacity: 1;
            max-height: 80vh;
        }

        /* --- Custom Scrollbar --- */
        #history-list {
            overflow-y: hidden; /* Hide scrollbar by default */
        }
        #history-panel.history-expanded #history-list {
            overflow-y: auto; /* Show scrollbar only when expanded */
        }
        #history-list::-webkit-scrollbar-button {
            display: none; /* Hide scrollbar arrows */
        }
        #history-list::-webkit-scrollbar {
            width: 8px;
        }
        #history-list::-webkit-scrollbar-track {
            background: transparent;
        }
        #history-list::-webkit-scrollbar-thumb {
            background: #010132;
            border-radius: 10px;
        }
        #history-list {
           scrollbar-width: thin;
           scrollbar-color: #010132 transparent;
        }

        /* Animation de la fl√®che */
        body.history-open #history-arrow {
            transform: rotate(-90deg);
        }
        
        /* [NOUVEAU] Animation de la fl√®che pour "Voir plus" */
        #history-panel.history-expanded #see-more-arrow {
            transform: rotate(180deg);
        }
        
        #prompt-loading {
            opacity: 0;
            transition: opacity 0.4s ease-in-out;
        }

        #prompt-loading.is-visible {
            opacity: 1;
        }

        /* --- Animation: Typewriter --- */
        .typewriter-loader {
            --blue: #5C86FF;
            --blue-dark: #275EFE;
            --key: #fff;
            --paper: #EEF0FD;
            --text: #D3D4EC;
            --tool: #FBC56C;
            --duration: 3s;
            position: relative;
            -webkit-animation: bounce05 var(--duration) linear infinite;
            animation: bounce05 var(--duration) linear infinite;
        }

        .typewriter-loader .slide {
            width: 92px;
            height: 20px;
            border-radius: 3px;
            margin-left: 14px;
            transform: translateX(14px);
            background: linear-gradient(var(--blue), var(--blue-dark));
            -webkit-animation: slide05 var(--duration) ease infinite;
            animation: slide05 var(--duration) ease infinite;
        }

        .typewriter-loader .slide:before, .typewriter-loader .slide:after,
        .typewriter-loader .slide i:before {
            content: "";
            position: absolute;
            background: var(--tool);
        }

        .typewriter-loader .slide:before {
            width: 2px;
            height: 8px;
            top: 6px;
            left: 100%;
        }

        .typewriter-loader .slide:after {
            left: 94px;
            top: 3px;
            height: 14px;
            width: 6px;
            border-radius: 3px;
        }

        .typewriter-loader .slide i {
            display: block;
            position: absolute;
            right: 100%;
            width: 6px;
            height: 4px;
            top: 4px;
            background: var(--tool);
        }

        .typewriter-loader .slide i:before {
            right: 100%;
            top: -2px;
            width: 4px;
            border-radius: 2px;
            height: 14px;
        }

        .typewriter-loader .paper {
            position: absolute;
            left: 24px;
            top: -26px;
            width: 40px;
            height: 46px;
            border-radius: 5px;
            background: var(--paper);
            transform: translateY(46px);
            -webkit-animation: paper05 var(--duration) linear infinite;
            animation: paper05 var(--duration) linear infinite;
        }

        .typewriter-loader .paper:before {
            content: "";
            position: absolute;
            left: 6px;
            right: 6px;
            top: 7px;
            border-radius: 2px;
            height: 4px;
            transform: scaleY(0.8);
            background: var(--text);
            box-shadow: 0 12px 0 var(--text), 0 24px 0 var(--text), 0 36px 0 var(--text);
        }

        .typewriter-loader .keyboard {
            width: 120px;
            height: 56px;
            margin-top: -10px;
            z-index: 1;
            position: relative;
        }

        .typewriter-loader .keyboard:before, .typewriter-loader .keyboard:after {
            content: "";
            position: absolute;
        }

        .typewriter-loader .keyboard:before {
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            border-radius: 7px;
            background: linear-gradient(135deg, var(--blue), var(--blue-dark));
            transform: perspective(10px) rotateX(2deg);
            transform-origin: 50% 100%;
        }

        .typewriter-loader .keyboard:after {
            left: 2px;
            top: 25px;
            width: 11px;
            height: 4px;
            border-radius: 2px;
            box-shadow: 15px 0 0 var(--key), 30px 0 0 var(--key), 45px 0 0 var(--key), 60px 0 0 var(--key), 75px 0 0 var(--key), 90px 0 0 var(--key), 22px 10px 0 var(--key), 37px 10px 0 var(--key), 52px 10px 0 var(--key), 60px 10px 0 var(--key), 68px 10px 0 var(--key), 83px 10px 0 var(--key);
            -webkit-animation: keyboard05 var(--duration) linear infinite;
            animation: keyboard05 var(--duration) linear infinite;
        }
        
        .custom-btn {
            padding: 0.5rem 1rem;
            border: 1px solid #cbd5e1; /* border-slate-300 */
            border-radius: 0.5rem; /* rounded-lg */
            background-color: transparent;
            font-weight: 600; /* semibold */
            color: #475569; /* text-slate-600 */
            transition: all 0.2s ease-in-out;
        }
        .custom-btn:hover {
            background-color: #f1f5f9; /* bg-slate-100 */
        }
        .custom-btn.active {
            background-color: #010132;
            color: white;
            border-color: #010132;
        }

        .loading-dots span {
            animation: blink 1.4s infinite both;
        }
        .loading-dots span:nth-child(2) {
            animation-delay: 0.2s;
        }
        .loading-dots span:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes bounce05 {
            85%, 92%, 100% {
                transform: translateY(0);
            }

            89% {
                transform: translateY(-4px);
            }

            95% {
                transform: translateY(2px);
            }
        }

        @keyframes slide05 {
            5% {
                transform: translateX(14px);
            }

            15%, 30% {
                transform: translateX(6px);
            }

            40%, 55% {
                transform: translateX(0);
            }

            65%, 70% {
                transform: translateX(-4px);
            }

            80%, 89% {
                transform: translateX(-12px);
            }

            100% {
                transform: translateX(14px);
            }
        }

        @keyframes paper05 {
            5% {
                transform: translateY(46px);
            }

            20%, 30% {
                transform: translateY(34px);
            }

            40%, 55% {
                transform: translateY(22px);
            }

            65%, 70% {
                transform: translateY(10px);
            }

            80%, 85% {
                transform: translateY(0);
            }

            92%, 100% {
                transform: translateY(46px);
            }
        }

        @keyframes keyboard05 {
            5%, 12%, 21%, 30%, 39%, 48%, 57%, 66%, 75%, 84% {
                box-shadow: 15px 0 0 var(--key), 30px 0 0 var(--key), 45px 0 0 var(--key), 60px 0 0 var(--key), 75px 0 0 var(--key), 90px 0 0 var(--key), 22px 10px 0 var(--key), 37px 10px 0 var(--key), 52px 10px 0 var(--key), 60px 10px 0 var(--key), 68px 10px 0 var(--key), 83px 10px 0 var(--key);
            }

            9% {
                box-shadow: 15px 2px 0 var(--key), 30px 0 0 var(--key), 45px 0 0 var(--key), 60px 0 0 var(--key), 75px 0 0 var(--key), 90px 0 0 var(--key), 22px 10px 0 var(--key), 37px 10px 0 var(--key), 52px 10px 0 var(--key), 60px 10px 0 var(--key), 68px 10px 0 var(--key), 83px 10px 0 var(--key);
            }

            18% {
                box-shadow: 15px 0 0 var(--key), 30px 0 0 var(--key), 45px 0 0 var(--key), 60px 2px 0 var(--key), 75px 0 0 var(--key), 90px 0 0 var(--key), 22px 10px 0 var(--key), 37px 10px 0 var(--key), 52px 10px 0 var(--key), 60px 10px 0 var(--key), 68px 10px 0 var(--key), 83px 10px 0 var(--key);
            }

            27% {
                box-shadow: 15px 0 0 var(--key), 30px 0 0 var(--key), 45px 0 0 var(--key), 60px 0 0 var(--key), 75px 0 0 var(--key), 90px 0 0 var(--key), 22px 12px 0 var(--key), 37px 10px 0 var(--key), 52px 10px 0 var(--key), 60px 10px 0 var(--key), 68px 10px 0 var(--key), 83px 10px 0 var(--key);
            }

            36% {
                box-shadow: 15px 0 0 var(--key), 30px 0 0 var(--key), 45px 0 0 var(--key), 60px 0 0 var(--key), 75px 0 0 var(--key), 90px 0 0 var(--key), 22px 10px 0 var(--key), 37px 10px 0 var(--key), 52px 12px 0 var(--key), 60px 12px 0 var(--key), 68px 12px 0 var(--key), 83px 10px 0 var(--key);
            }

            45% {
                box-shadow: 15px 0 0 var(--key), 30px 0 0 var(--key), 45px 0 0 var(--key), 60px 0 0 var(--key), 75px 0 0 var(--key), 90px 2px 0 var(--key), 22px 10px 0 var(--key), 37px 10px 0 var(--key), 52px 10px 0 var(--key), 60px 10px 0 var(--key), 68px 10px 0 var(--key), 83px 10px 0 var(--key);
            }

            54% {
                box-shadow: 15px 0 0 var(--key), 30px 2px 0 var(--key), 45px 0 0 var(--key), 60px 0 0 var(--key), 75px 0 0 var(--key), 90px 0 0 var(--key), 22px 10px 0 var(--key), 37px 10px 0 var(--key), 52px 10px 0 var(--key), 60px 10px 0 var(--key), 68px 10px 0 var(--key), 83px 10px 0 var(--key);
            }

            63% {
                box-shadow: 15px 0 0 var(--key), 30px 0 0 var(--key), 45px 0 0 var(--key), 60px 0 0 var(--key), 75px 0 0 var(--key), 90px 0 0 var(--key), 22px 10px 0 var(--key), 37px 10px 0 var(--key), 52px 10px 0 var(--key), 60px 10px 0 var(--key), 68px 10px 0 var(--key), 83px 12px 0 var(--key);
            }

            72% {
                box-shadow: 15px 0 0 var(--key), 30px 0 0 var(--key), 45px 2px 0 var(--key), 60px 0 0 var(--key), 75px 0 0 var(--key), 90px 0 0 var(--key), 22px 10px 0 var(--key), 37px 10px 0 var(--key), 52px 10px 0 var(--key), 60px 10px 0 var(--key), 68px 10px 0 var(--key), 83px 10px 0 var(--key);
            }

            81% {
                box-shadow: 15px 0 0 var(--key), 30px 0 0 var(--key), 45px 0 0 var(--key), 60px 0 0 var(--key), 75px 0 0 var(--key), 90px 0 0 var(--key), 22px 10px 0 var(--key), 37px 12px 0 var(--key), 52px 10px 0 var(--key), 60px 10px 0 var(--key), 68px 10px 0 var(--key), 83px 10px 0 var(--key);
            }
        }

        @keyframes blink {
            0% {
                opacity: .2;
            }
            20% {
                opacity: 1;
            }
            100% {
                opacity: .2;
            }
        }

        @media (max-width: 1023px) {
            #history-trigger {
                position: relative;
                top: auto;
                right: auto;
                transform: none;
                padding-left: 0;
                text-align: center;
                margin-top: 1.5rem;
            }

            #history-panel {
                position: relative;
                left: 0;
                top: auto;
                width: 100%;
                margin-top: 1rem;
            }

            body.history-open #main-panel {
                transform: none;
            }
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-800 flex flex-col min-h-screen">
    <div class="flex-grow">
        <div class="container mx-auto px-6 py-12">
            <div class="relative">
                <div id="main-panel" class="md:w-2/3 mx-auto relative transition-transform duration-700 ease-in-out">
                    <div class="bg-white p-8 rounded-2xl shadow-lg flex flex-col">
                        <div class="text-center mb-8">
                            <div id="lang-switcher" class="flex justify-center gap-2 mb-4">
                                <button id="lang-fr-btn" class="custom-btn text-sm active">FR</button>
                                <button id="lang-en-btn" class="custom-btn text-sm">EN</button>
                            </div>
                            <h2 data-i18n-key="title" class="text-3xl font-bold text-[#010132]">D√©couvrez des id√©es de prompts</h2>
                        </div>
                        <div class="flex-grow">
                            <p data-i18n-key="intro_text" class="text-slate-600 mb-6">S√©lectionnez une t√¢che pour obtenir un prompt adapt√© que vous pourriez utiliser avec un outil d'IA.</p>
                            <div class="relative" id="custom-select-container">
                                <div id="select-selected" class="w-full p-3 border border-slate-300 rounded-lg mb transition-all duration-300 flex justify-between items-center cursor-pointer">
                                    <span id="select-text" data-i18n-key="select_task">S√©lectionnez une t√¢che...</span>
                                    <svg id="select-arrow" class="select-arrow w-5 h-5 text-slate-500" xmlns="[http://www.w3.org/2000/svg](http://www.w3.org/2000/svg)" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg>
                                </div>
                                <div id="select-options" class="hidden absolute top-full left-0 right-0 bg-white border border-t-0 border-slate-300 rounded-b-lg shadow-lg z-10 overflow-hidden"></div>
                            </div>
                            <p data-i18n-key="or_text" class="text-center text-slate-500 my-4">ou</p>
                            <div class="relative mb-8 flex items-center">
                                <input type="text" id="custom-task-input" data-i18n-placeholder-key="custom_task_placeholder" placeholder="Entrez une t√¢che personnalis√©e ici..." class="w-full p-3 border border-slate-300 rounded-lg transition-all duration-300 focus:border-[#010132] focus:ring-1 focus:ring-[#010132]">
                                <button id="inspire-me-btn" data-i18n-key="inspire_me" class="custom-btn text-sm px-3 flex-shrink-0 ml-6" style="padding-top: 0.875rem; padding-bottom: 0.875rem; font-weight: 600;">J'ai besoin d'inspiration</button>
                            </div>
                        </div>
                        <div id="customization-options" class="space-y-6 mb-8">
                            <div>
                                <label data-i18n-key="tone_label" class="block text-slate-700 font-bold mb-2">üé® Ton</label>
                                <div id="tone-options" class="flex flex-wrap gap-2">
                                    <button data-value="Professionnel" data-i18n-key="tone_professional" class="custom-btn">Professionnel</button>
                                    <button data-value="Amical" data-i18n-key="tone_friendly" class="custom-btn">Amical</button>
                                    <button data-value="Cr√©atif" data-i18n-key="tone_creative" class="custom-btn">Cr√©atif</button>
                                    <button data-value="Urgent" data-i18n-key="tone_urgent" class="custom-btn">Urgent</button>
                                </div>
                            </div>
                            <div>
                                <label data-i18n-key="detail_label" class="block text-slate-700 font-bold mb-2">üìä Niveau de d√©tail</label>
                                <div id="detail-options" class="flex flex-wrap gap-2">
                                    <button data-value="Concise" data-i18n-key="detail_concise" class="custom-btn">Concise</button>
                                    <button data-value="Standard" data-i18n-key="detail_standard" class="custom-btn active">Standard</button>
                                    <button data-value="Tr√®s d√©taill√©" data-i18n-key="detail_detailed" class="custom-btn">Tr√®s d√©taill√©</button>
                                </div>
                            </div>
                        </div>
                        <div>
                            <button id="generate-prompt-btn" class="w-full bg-[#49b048] hover:bg-[#3f993e] text-white font-bold py-3 px-4 rounded-lg transition-colors duration-300 disabled:bg-slate-400 flex items-center justify-center" disabled>
                                <span id="btn-text" data-i18n-key="generate_button">G√©n√©rer un prompt</span>
                                <span id="btn-emoji" class="hidden ml-2"> ‚ú®</span>
                                <svg id="btn-spinner" class="animate-spin ml-2 h-5 w-5 text-white hidden" xmlns="[http://www.w3.org/2000/svg](http://www.w3.org/2000/svg)" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>
                            </button>
                            <div id="prompt-output" class="mt-8 p-4 bg-slate-100 rounded-lg text-slate-800 hidden"></div>
                            <div id="pro-tip-output" class="mt-4 p-4 rounded-lg hidden" style="background-color: #EEF0FD; border-left: 4px solid #5C86FF; color: #010132;"></div>
                            <button id="copy-btn" data-i18n-key="copy_button" class="mt-8 w-full bg-slate-200 hover:bg-slate-300 text-slate-600 font-bold py-3 px-4 rounded-lg hidden">Copier le prompt</button>
                            <div id="prompt-loading" class="mt-8 text-center hidden">
                                <div class="flex justify-center items-center py-8">
                                    <div class="typewriter-loader">
                                        <div class="slide"><i></i></div>
                                        <div class="paper"></div>
                                        <div class="keyboard"></div>
                                    </div>
                                </div>
                                <p id="loading-text" data-i18n-key="loading_text_default" class="text-[#010132] font-semibold">R√©daction en cours...</p>
                            </div>
                        </div>
                    </div>
                        <div id="history-trigger" class="absolute top-8 -right-4 translate-x-full pl-4 cursor-pointer group">
                            <h3 data-i18n-key="history_title" class="text-lg font-bold text-slate-500 group-hover:text-[#010132] transition-colors whitespace-nowrap">
                            Historique r√©cent <span id="history-arrow" class="inline-block transition-transform duration-300">‚Üí</span>
                            </h3>
                        </div>
                        <div id="history-panel" class="flex flex-col">
                            <div id="history-list" class="flex-grow space-y-2 max-h-[calc(80vh-8rem)] pr-2">
                            </div>
                            <div id="see-more-trigger" class="hidden cursor-pointer group pt-3 mt-3 border-t border-slate-200">
                                <h3 class="text-md font-bold text-slate-500 group-hover:text-[#010132] transition-colors">
                                    <span id="see-more-text" data-i18n-key="see_more">Voir plus</span>
                                    <span id="see-more-arrow" class="inline-block align-middle transition-transform duration-300">‚Üì</span>
                                </h3>
                            </div>
                            <div id="export-history-container" class="pt-3 mt-auto hidden">
                                <button id="export-history-btn" data-i18n-key="export_history" class="w-full custom-btn text-sm" style="padding-top: 0.875rem; padding-bottom: 0.875rem;">Exporter l'historique (.txt)</button>
                            </div>
                        </div>
                </div>
            </div>      
        </div>
    </div>
    <footer class="py-8">
        <div class="container mx-auto px-6 text-center">
            <a href="https://lapuce.org" target="_blank" rel="noopener noreferrer" class="inline-block">
                <img src="https://lapuce.org/new/wp-content/uploads/2024/03/cropped-VersionImpression.png" alt="Logo de La Puce Ressource Informatique" class="h-16 mx-auto">
            </a>
        </div>
    </footer>

<script>
    const translations = {
        fr: {
            title: "D√©couvrez des id√©es de prompts",
            intro_text: "S√©lectionnez une t√¢che pour obtenir un prompt adapt√© que vous pourriez utiliser avec un outil d'IA.",
            select_task: "S√©lectionnez une t√¢che...",
            or_text: "ou",
            custom_task_placeholder: "Entrez une t√¢che personnalis√©e ici...",
            inspire_me: "J'ai besoin d'inspiration",
            tone_label: "üé® Ton",
            tone_professional: "Professionnel",
            tone_friendly: "Amical",
            tone_creative: "Cr√©atif",
            tone_urgent: "Urgent",
            detail_label: "üìä Niveau de d√©tail",
            detail_concise: "Concise",
            detail_standard: "Standard",
            detail_detailed: "Tr√®s d√©taill√©",
            generate_button: "G√©n√©rer un prompt",
            generate_button_again: "G√©n√©rer un autre prompt",
            generate_button_final: "Encore un autre prompt ?",
            copy_button: "Copier le prompt",
            copied_button: "Copi√© !",
            copy_error_button: "Erreur",
            loading_text_default: "R√©daction en cours...",
            history_title: "Historique r√©cent",
            see_more: "Voir plus",
            see_less: "Voir moins",
            export_history: "Exporter l'historique (.txt)",
            export_alert_empty: "L'historique est vide. G√©n√©rez un prompt pour pouvoir l'exporter.",
            rate_limit_error: "Oups ! Trop de requ√™tes en m√™me temps, veuillez patienter une minute.",
            server_error: "D√©sol√©, une erreur est survenue. Veuillez r√©essayer.",
            api_invalid_response_error: "R√©ponse invalide de l'API",
            inspire_me_limit: "Limite atteinte",
            inspire_me_error: "Erreur lors de la g√©n√©ration. Veuillez r√©essayer.",
            tasks: [
                { value: "r√©diger un courriel de remerciement pour un b√©n√©vole", text: "R√©diger un courriel de remerciement" },
                { value: "r√©sumer un rapport financier annuel", text: "R√©sumer un rapport financier" },
                { value: "cr√©er un plan de communication pour un √©v√©nement", text: "Cr√©er un plan de communication" },
                { value: "brainstormer des id√©es de lev√©e de fonds", text: "Brainstormer des id√©es de lev√©e de fonds" },
                { value: "cr√©er une publication pour les r√©seaux sociaux pour annoncer un √©v√©nement", text: "Cr√©er une publication pour les r√©seaux sociaux" },
                { value: "r√©diger une demande de subvention", text: "R√©diger une demande de subvention" },
                { value: "cr√©er un sondage de satisfaction pour les b√©n√©voles", text: "Sondage de satisfaction pour les b√©n√©voles" }
            ],
            all_loading_messages: ["Assemblage des id√©es...", "Pr√©paration de la toile...", "M√©lange des couleurs...", "Touche finale du pinceau...", "Votre chef-d'≈ìuvre arrive...", "D√©marrage des machines...", "Calibration des circuits...", "Compilation des donn√©es...", "Optimisation de l'algorithme...", "G√©n√©ration du r√©sultat...", "Consultation de la boule de cristal...", "M√©lange des potions...", "Invocation des esprits cr√©atifs...", "Saupoudrage de poussi√®re d'√©toiles...", "La magie op√®re..."],
            prompt_template: {
                intro: `Ta r√©ponse doit commencer par une phrase d'introduction amicale et contextuelle qui varie √† chaque fois. Par exemple : "Voici un prompt que vous pourriez utiliser avec votre agent conversationnel pr√©f√©r√© pour la t√¢che suivante :" ou "Pour vous aider avec la t√¢che suivante, voici une suggestion de prompt :".`,
                task_instruction: `Ensuite, r√©dige un prompt pour la t√¢che :`,
                context: `Ce prompt doit √™tre adapt√© au contexte d'un organisme communautaire (OBNL).`,
                customization_instructions_title: `Instructions suppl√©mentaires pour le prompt que tu g√©n√®res :`,
                tone_instruction: `- Le ton doit √™tre :`,
                detail_instruction: `- Le niveau de d√©tail doit √™tre :`,
                formatting_instructions_title: `Instructions de formatage pour le prompt que tu g√©n√®res :`,
                formatting_instruction_1: `1. Le mot "**Prompt**" doit √™tre en gras (entour√© de double ast√©risques).`,
                formatting_instruction_2: `2. Les √©l√©ments que l'utilisateur doit remplacer par ses propres informations doivent √™tre entre doubles crochets, comme ceci : [[√âL√âMENT √Ä COMPL√âTER]].`,
                pro_tip_instruction: `Apr√®s avoir g√©n√©r√© le prompt, ins√®re le s√©parateur unique "[PRO_TIP_SEPARATOR]". Ensuite, ajoute une section intitul√©e "**üí° Astuce Pro**" et donne un conseil court, pertinent et actionnable (en 1-2 phrases) sur la meilleure fa√ßon d'utiliser ou d'am√©liorer ce prompt sp√©cifique.`,
                language_instruction: `La r√©ponse enti√®re (introduction, prompt, et astuce) doit √™tre r√©dig√©e en **fran√ßais**.`
            },
            inspire_me_prompt: `G√©n√®re une seule id√©e de t√¢che simple et courte pour un employ√© ou un b√©n√©vole d'un organisme √† but non lucratif (OBNL) au Qu√©bec. La t√¢che doit √™tre similaire en complexit√© √† "r√©diger une demande de subvention" ou "cr√©er une publication pour les r√©seaux sociaux". R√©ponds uniquement avec l'intitul√© de la t√¢che, sans aucune phrase d'introduction, formatage (pas de gras, pas d'ast√©risques), ou ponctuation finale. La r√©ponse doit √™tre en **fran√ßais**.`
        },
        en: {
            title: "Discover Prompt Ideas",
            intro_text: "Select a task to get a tailored prompt you could use with an AI tool.",
            select_task: "Select a task...",
            or_text: "or",
            custom_task_placeholder: "Enter a custom task here...",
            inspire_me: "I need inspiration",
            tone_label: "üé® Tone",
            tone_professional: "Professional",
            tone_friendly: "Friendly",
            tone_creative: "Creative",
            tone_urgent: "Urgent",
            detail_label: "üìä Detail Level",
            detail_concise: "Concise",
            detail_standard: "Standard",
            detail_detailed: "Very Detailed",
            generate_button: "Generate Prompt",
            generate_button_again: "Generate Another Prompt",
            generate_button_final: "Yet Another Prompt?",
            copy_button: "Copy Prompt",
            copied_button: "Copied!",
            copy_error_button: "Error",
            loading_text_default: "Writing in progress...",
            history_title: "Recent History",
            see_more: "See more",
            see_less: "See less",
            export_history: "Export History (.txt)",
            export_alert_empty: "History is empty. Generate a prompt to be able to export it.",
            rate_limit_error: "Oops! Too many requests at once, please wait a minute.",
            server_error: "Sorry, an error occurred. Please try again.",
            api_invalid_response_error: "Invalid response from API",
            inspire_me_limit: "Limit reached",
            inspire_me_error: "Error during generation. Please try again.",
            tasks: [
                { value: "write a thank-you email to a volunteer", text: "Write a thank-you email" },
                { value: "summarize an annual financial report", text: "Summarize a financial report" },
                { value: "create a communication plan for an event", text: "Create a communication plan" },
                { value: "brainstorm fundraising ideas", text: "Brainstorm fundraising ideas" },
                { value: "create a social media post to announce an event", text: "Create a social media post" },
                { value: "write a grant application", text: "Write a grant application" },
                { value: "create a satisfaction survey for volunteers", text: "Volunteer satisfaction survey" }
            ],
            all_loading_messages: ["Assembling ideas...", "Preparing the canvas...", "Mixing the colors...", "Final brushstroke...", "Your masterpiece is coming...", "Starting the engines...", "Calibrating circuits...", "Compiling data...", "Optimizing the algorithm...", "Generating the result...", "Consulting the crystal ball...", "Mixing potions...", "Summoning creative spirits...", "Sprinkling stardust...", "The magic is happening..."],
            prompt_template: {
                intro: `Your response must start with a friendly, contextual introductory sentence that varies each time. For example: "Here is a prompt you could use with your favorite conversational AI for the following task:" or "To help you with the following task, here is a suggested prompt:".`,
                task_instruction: `Next, write a prompt for the task:`,
                context: `This prompt should be adapted to the context of a community organization (NPO).`,
                customization_instructions_title: `Additional instructions for the prompt you generate:`,
                tone_instruction: `- The tone should be:`,
                detail_instruction: `- The level of detail should be:`,
                formatting_instructions_title: `Formatting instructions for the prompt you generate:`,
                formatting_instruction_1: `1. The word "**Prompt**" must be in bold (surrounded by double asterisks).`,
                formatting_instruction_2: `2. Elements that the user should replace with their own information must be between double brackets, like this: [[ITEM TO COMPLETE]].`,
                pro_tip_instruction: `After generating the prompt, insert the unique separator "[PRO_TIP_SEPARATOR]". Then, add a section titled "**üí° Pro Tip**" and provide a short, relevant, and actionable piece of advice (in 1-2 sentences) on how to best use or improve this specific prompt.`,
                language_instruction: `The entire response (introduction, prompt, and tip) must be written in **English**.`
            },
            inspire_me_prompt: `Generate a single, short, and simple task idea for an employee or volunteer of a non-profit organization (NPO) in Quebec. The task should be similar in complexity to "write a grant application" or "create a social media post". Respond only with the task title, without any introductory sentences, formatting (no bold, no asterisks), or final punctuation. The response must be in **English**.`
        }
    };

    function parseMarkdown(text) {
        let html = text.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
        html = html.replace(/\[\[(.*?)\]\]/g, '<code class="bg-slate-200 text-red-600 font-mono py-1 px-2 rounded-md text-sm">[$1]</code>');
        html = html.replace(/\n/g, '<br>');
        return html;
    }

    function renderPromptAndTip(fullText, promptEl, tipEl) {
        const separator = '[PRO_TIP_SEPARATOR]';
        const parts = fullText.split(separator);
        const mainPrompt = parts[0];
        const proTip = parts.length > 1 ? parts[1] : '';

        promptEl.innerHTML = parseMarkdown(mainPrompt.trim());
        promptEl.classList.remove('hidden');

        tipEl.classList.add('hidden'); // Hide tip by default
        if (proTip) {
            tipEl.innerHTML = parseMarkdown(proTip.trim());
            tipEl.classList.remove('hidden');
        }
    }

    let loadingInterval;
    let isHistoryExpanded = false;
    const allLoadingMessages = ["Assemblage des id√©es...", "Pr√©paration de la toile...", "M√©lange des couleurs...", "Touche finale du pinceau...", "Votre chef-d'≈ìuvre arrive...", "D√©marrage des machines...", "Calibration des circuits...", "Compilation des donn√©es...", "Optimisation de l'algorithme...", "G√©n√©ration du r√©sultat...", "Consultation de la boule de cristal...", "M√©lange des potions...", "Invocation des esprits cr√©atifs...", "Saupoudrage de poussi√®re d'√©toiles...", "La magie op√®re..."];
    const SAFETY_INSTRUCTIONS = `\n\nConsignes de s√©curit√© : Ta r√©ponse ne doit contenir aucun contenu violent, haineux, sexuel, discriminatoire, ou offensant. √âvite les sujets controvers√©s comme la politique, la guerre, ou la religion. Reste strictement dans un contexte professionnel, amical et s√©curitaire.`;

    function savePromptToHistory(promptText) {
        const history = JSON.parse(localStorage.getItem('promptHistory')) || [];
        history.unshift(promptText);
        const limitedHistory = history.slice(0, 20);
        localStorage.setItem('promptHistory', JSON.stringify(limitedHistory));
    }

    function renderHistory() {
        const history = JSON.parse(localStorage.getItem('promptHistory')) || [];
        const historyList = document.getElementById('history-list');
        const seeMoreTrigger = document.getElementById('see-more-trigger');
        const seeMoreText = document.getElementById('see-more-text');
        const promptOutput = document.getElementById('prompt-output');
        const proTipOutput = document.getElementById('pro-tip-output');
        const copyBtn = document.getElementById('copy-btn');
        const exportHistoryContainer = document.getElementById('export-history-container');

        historyList.innerHTML = '';

        if (history.length > 0) {
            exportHistoryContainer.classList.remove('hidden');
            const itemsToShow = (isHistoryExpanded || history.length <= 6) ? history : history.slice(0, 6);
            itemsToShow.forEach(promptText => {
                const historyItem = document.createElement('div');
                historyItem.className = 'p-3 bg-slate-100 rounded-lg cursor-pointer hover:bg-slate-200 transition-colors text-sm text-slate-700';
                historyItem.textContent = promptText.substring(0, 100) + (promptText.length > 100 ? '...' : '');
                historyItem.addEventListener('click', () => {
                    renderPromptAndTip(promptText, promptOutput, proTipOutput);
                    copyBtn.classList.remove('hidden');
                    promptOutput.scrollIntoView({
                        behavior: 'smooth',
                        block: 'center'
                    });
                });
                historyList.appendChild(historyItem);
            });
            if (history.length > 6) {
                seeMoreTrigger.classList.remove('hidden');
                seeMoreText.textContent = isHistoryExpanded ? 'Voir moins' : 'Voir plus';
            } else {
                seeMoreTrigger.classList.add('hidden');
            }
        } else {
            exportHistoryContainer.classList.add('hidden');
        }
    }

    function shuffle(a) {
        for (let i = a.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [a[i], a[j]] = [a[j], a[i]];
        }
        return a;
    }

    async function callGeminiAPI(prompt, outputElement, proTipElement, loadingElement, copyBtn) {
        outputElement.innerHTML = '';
        outputElement.classList.add('hidden');
        proTipElement.classList.add('hidden');
        copyBtn.classList.add('hidden');
        loadingElement.classList.remove('hidden');
        setTimeout(() => loadingElement.classList.add('is-visible'), 10);
        const loadingTextElement = document.getElementById('loading-text');
        const shuffledMessages = shuffle([...allLoadingMessages]);
        let messageIndex = 0;
        loadingTextElement.textContent = shuffledMessages[messageIndex];
        loadingInterval = setInterval(() => {
            messageIndex = (messageIndex + 1) % shuffledMessages.length;
            loadingTextElement.classList.add('is-fading');
            setTimeout(() => {
                loadingTextElement.textContent = shuffledMessages[messageIndex];
                loadingTextElement.classList.remove('is-fading');
            }, 500);
        }, 2000);
        const proxyApiUrl = "https://gemini-proxy-notion.michael-araujo.workers.dev/";
        const payload = {
            prompt: prompt,
            model: 'gemini-2.0-flash-lite'
        };
        try {
            const response = await fetch(proxyApiUrl, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(payload)
            });
            if (!response.ok) {
                if (response.status === 429) {
                    const rateLimitError = new Error("Rate limit exceeded");
                    rateLimitError.isRateLimit = true;
                    throw rateLimitError;
                }
                throw new Error(`Erreur du serveur: ${response.status}`);
            }
            const result = await response.json();
            const text = result?.text;
            if (text) {
                renderPromptAndTip(text, outputElement, proTipElement);
                copyBtn.classList.remove('hidden');
                savePromptToHistory(text);
                renderHistory();
            } else {
                throw new Error(translations[currentLang].api_invalid_response_error);
            }
        } catch (error) {
            console.error(error);
            if (error.isRateLimit) {
                outputElement.innerHTML = translations[currentLang].rate_limit_error;
            } else {
                outputElement.innerHTML = translations[currentLang].server_error;
            }
            outputElement.classList.remove('hidden');
        } finally {
            clearInterval(loadingInterval);
            loadingElement.classList.remove('is-visible');
            setTimeout(() => {
                loadingElement.classList.add('hidden');
            }, 400);
        }
    }

    document.addEventListener('DOMContentLoaded', () => {
        const frBtn = document.getElementById('lang-fr-btn');
        const enBtn = document.getElementById('lang-en-btn');
        const selectContainer = document.getElementById('custom-select-container');
        const selectedDisplay = document.getElementById('select-selected');
        const selectText = document.getElementById('select-text');
        const selectArrow = document.getElementById('select-arrow');
        const optionsContainer = document.getElementById('select-options');
        const customTaskInput = document.getElementById('custom-task-input');
        const generatePromptBtn = document.getElementById('generate-prompt-btn');
        const btnEmoji = document.getElementById('btn-emoji');
        const btnText = document.getElementById('btn-text');
        const promptOutput = document.getElementById('prompt-output');
        const proTipOutput = document.getElementById('pro-tip-output');
        const promptLoading = document.getElementById('prompt-loading');
        const copyBtn = document.getElementById('copy-btn');
        const historyTrigger = document.getElementById('history-trigger');
        const historyPanel = document.getElementById('history-panel');
        const seeMoreTrigger = document.getElementById('see-more-trigger');
        const inspireMeBtn = document.getElementById('inspire-me-btn');
        const exportHistoryBtn = document.getElementById('export-history-btn');
        
        let currentLang = 'fr';
        let selectedValue = "";
        let promptGenerationCount = 0;
        let inspirationClickCount = 0;
        let selectedTone = '';
        let selectedDetail = 'Standard';

        const setLanguage = (lang) => {
            currentLang = lang;
            localStorage.setItem('preferredLang', lang);

            frBtn.classList.toggle('active', lang === 'fr');
            enBtn.classList.toggle('active', lang === 'en');

            document.querySelectorAll('[data-i18n-key]').forEach(el => {
                const key = el.getAttribute('data-i18n-key');
                const translation = translations[lang][key];
                if (translation) {
                    if (el.parentElement.id === 'history-trigger') {
                        el.firstChild.textContent = translation + ' ';
                    } else {
                        el.textContent = translation;
                    }
                }
            });

            document.querySelectorAll('[data-i18n-placeholder-key]').forEach(el => {
                const key = el.getAttribute('data-i18n-placeholder-key');
                if (translations[lang][key]) {
                    el.placeholder = translations[lang][key];
                }
            });

            optionsContainer.innerHTML = '';
            const taskOptions = [
                { value: "", text: translations[lang].select_task },
                ...translations[lang].tasks
            ];
            taskOptions.forEach(option => {
                const optionEl = document.createElement('div');
                optionEl.textContent = option.text;
                optionEl.dataset.value = option.value;
                optionEl.classList.add('p-3', 'cursor-pointer', 'hover:bg-slate-100');
                if (option.value === "") {
                    optionEl.classList.add('text-slate-500');
                }
                optionEl.addEventListener('click', () => {
                    selectText.textContent = option.text;
                    selectedValue = option.value;
                    customTaskInput.value = "";
                    closeSelect();
                    updateUIState();
                });
                optionsContainer.appendChild(optionEl);
            });
            selectText.textContent = translations[lang].select_task;
            selectedValue = "";
            updateUIState();
        };

        frBtn.addEventListener('click', () => setLanguage('fr'));
        enBtn.addEventListener('click', () => setLanguage('en'));

        const toneOptions = document.getElementById('tone-options');
        const detailOptions = document.getElementById('detail-options');

        function setupButtonGroup(container, variableSetter) {
            const buttons = container.querySelectorAll('button');
            buttons.forEach(button => {
                button.addEventListener('click', (e) => {
                    e.preventDefault();
                    buttons.forEach(btn => btn.classList.remove('active'));
                    e.currentTarget.classList.add('active');
                    variableSetter(e.currentTarget.dataset.value);
                });
            });
        }

        setupButtonGroup(toneOptions, (value) => selectedTone = value);
        setupButtonGroup(detailOptions, (value) => selectedDetail = value);
        
        customTaskInput.addEventListener('input', () => {
            if (customTaskInput.value.trim() !== '') {
                selectedValue = "";
                selectText.textContent = translations[currentLang].select_task;
            }
            updateUIState();
        });

        function closeSelect() {
            optionsContainer.classList.add('hidden');
            selectArrow.classList.remove('select-arrow-up');
        }
        selectedDisplay.addEventListener('click', (e) => {
            e.stopPropagation();
            optionsContainer.classList.toggle('hidden');
            selectArrow.classList.toggle('select-arrow-up');
        });
        window.addEventListener('click', (e) => {
            if (!selectContainer.contains(e.target)) {
                closeSelect();
            }
        });

        inspireMeBtn.addEventListener('click', async () => {
            if (inspirationClickCount >= 2) {
                return;
            }

            inspirationClickCount++;
            const originalButtonText = inspireMeBtn.innerHTML;
            inspireMeBtn.disabled = true;
            inspireMeBtn.innerHTML = `<span class="loading-dots" style="font-size: 2rem; line-height: 0.5;"><span>.</span><span>.</span><span>.</span></span>`;

            const inspirationPrompt = translations[currentLang].inspire_me_prompt + SAFETY_INSTRUCTIONS;

            const proxyApiUrl = "https://gemini-proxy-notion.michael-araujo.workers.dev/";
            const payload = {
                prompt: inspirationPrompt,
                model: 'gemini-2.0-flash-lite'
            };

            try {
                const response = await fetch(proxyApiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    throw new Error(`API Error: ${response.status}`);
                }

                const result = await response.json();
                let taskText = result?.text?.trim();

                if (taskText) {
                    taskText = taskText.replace(/^"|"$|^\*+\s*|\s*\*+$|^\s*-\s*/gm, '');
                    customTaskInput.value = taskText;
                    selectText.textContent = translations[currentLang].select_task;
                    selectedValue = "";
                    updateUIState();
                } else {
                    throw new Error(translations[currentLang].api_invalid_response_error);
                }

            } catch (error) {
                console.error("Error during inspiration generation:", error);
                customTaskInput.value = translations[currentLang].inspire_me_error;
            } finally {
                if (inspirationClickCount >= 2) {
                    inspireMeBtn.innerHTML = translations[currentLang].inspire_me_limit;
                } else {
                    inspireMeBtn.disabled = false;
                    inspireMeBtn.innerHTML = originalButtonText;
                }
            }
        });

        function updateUIState() {
            const isTaskSelected = selectedValue !== '';
            const isCustomTaskEntered = customTaskInput.value.trim() !== '';
            generatePromptBtn.disabled = !isTaskSelected && !isCustomTaskEntered;
            if (isTaskSelected || isCustomTaskEntered) {
                btnEmoji.classList.remove('hidden');
            } else {
                btnEmoji.classList.add('hidden');
            }
            if (isTaskSelected) {
                selectedDisplay.classList.add('border-[#010132]', 'border-2');
            } else {
                selectedDisplay.classList.remove('border-[#010132]', 'border-2');
            }
            if (isCustomTaskEntered) {
                customTaskInput.classList.add('border-[#010132]', 'border-2');
            } else {
                customTaskInput.classList.remove('border-[#010132]', 'border-2');
            }
        }

        generatePromptBtn.addEventListener('click', () => {
            const customTaskValue = customTaskInput.value.trim();
            const task = customTaskValue !== '' ? customTaskValue : selectedValue;

            if (task) {
                promptGenerationCount++;
                if (promptGenerationCount >= 10) {
                    btnText.textContent = translations[currentLang].generate_button_final;
                } else if (promptGenerationCount >= 1) {
                    btnText.textContent = translations[currentLang].generate_button_again;
                }

                const t = translations[currentLang].prompt_template;
                let customizationInstructions = `\n\n${t.customization_instructions_title}`;
                let hasCustomizations = false;
                if (selectedTone) {
                    customizationInstructions += `\n${t.tone_instruction} **${selectedTone}**.`;
                    hasCustomizations = true;
                }
                if (selectedDetail) {
                    customizationInstructions += `\n${t.detail_instruction} **${selectedDetail}**.`;
                    hasCustomizations = true;
                }
                
                const prompt = `${t.intro}

${t.task_instruction} "${task}".

${t.context}
${hasCustomizations ? customizationInstructions : ''}

${t.formatting_instructions_title}
${t.formatting_instruction_1}
${t.formatting_instruction_2}

${t.pro_tip_instruction}

${t.language_instruction}` + SAFETY_INSTRUCTIONS;
                callGeminiAPI(prompt, promptOutput, proTipOutput, promptLoading, copyBtn);
            }
        });
        
        copyBtn.addEventListener('click', () => {
            const promptText = promptOutput.innerText;
            navigator.clipboard.writeText(promptText).then(() => {
                const originalClasses = ['bg-slate-200', 'hover:bg-slate-300', 'text-slate-600'];
                const successClasses = ['bg-[#49b048]', 'text-white'];
                copyBtn.classList.remove(...originalClasses);
                copyBtn.classList.add(...successClasses);
                copyBtn.textContent = translations[currentLang].copied_button;
                setTimeout(() => {
                    copyBtn.textContent = translations[currentLang].copy_button;
                    copyBtn.classList.remove(...successClasses);
                    copyBtn.classList.add(...originalClasses);
                }, 2000);
            }, (err) => {
                console.error('Could not copy text: ', err);
                copyBtn.textContent = translations[currentLang].copy_error_button;
            });
        });
        historyTrigger.addEventListener('click', () => {
            document.body.classList.toggle('history-open');
        });
        seeMoreTrigger.addEventListener('click', () => {
            isHistoryExpanded = !isHistoryExpanded;
            historyPanel.classList.toggle('history-expanded');
            const seeMoreText = document.getElementById('see-more-text');
            seeMoreText.textContent = isHistoryExpanded ? translations[currentLang].see_less : translations[currentLang].see_more;
            renderHistory();
        });

        exportHistoryBtn.addEventListener('click', () => {
            const history = JSON.parse(localStorage.getItem('promptHistory')) || [];
            if (history.length === 0) {
                alert(translations[currentLang].export_alert_empty);
                return;
            }

            const chronologicalHistory = [...history].reverse();

            const fileContent = chronologicalHistory.map((prompt, index) => {
                return `====================\nPROMPT ${index + 1}\n====================\n\n${prompt}`;
            }).join('\n\n\n');

            const blob = new Blob([fileContent], { type: 'text/plain;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = 'id√©es-prompts-lapuce.txt';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
        });

        updateUIState();
        renderHistory();

        // Initial language setup
        const preferredLang = localStorage.getItem('preferredLang') || 'fr';
        setLanguage(preferredLang);

        // Service Worker Registration
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js').then(registration => {
                    console.log('ServiceWorker registration successful with scope: ', registration.scope);
                }, err => {
                    console.log('ServiceWorker registration failed: ', err);
                });
            });
        }
    });
</script>
</body>
</html>
