<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Exp√©rimenter ces prompts</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;700;800&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Montserrat', sans-serif;
        }

        /* --- Custom Select --- */
        .select-arrow {
            transition: transform 0.3s ease;
        }
        .select-arrow-up {
            transform: rotate(180deg);
        }

        /* --- Loading Text Animation --- */
        #loading-text {
            transition: opacity 0.5s ease-in-out;
        }
        #loading-text.is-fading {
            opacity: 0;
        }

        /* --- Animation: Typewriter --- */
        .typewriter-loader {
            --blue: #5C86FF;
            --blue-dark: #275EFE;
            --key: #fff;
            --paper: #EEF0FD;
            --text: #D3D4EC;
            --tool: #FBC56C;
            --duration: 3s;
            position: relative;
            -webkit-animation: bounce05 var(--duration) linear infinite;
            animation: bounce05 var(--duration) linear infinite;
        }

        .typewriter-loader .slide {
            width: 92px;
            height: 20px;
            border-radius: 3px;
            margin-left: 14px;
            transform: translateX(14px);
            background: linear-gradient(var(--blue), var(--blue-dark));
            -webkit-animation: slide05 var(--duration) ease infinite;
            animation: slide05 var(--duration) ease infinite;
        }

        .typewriter-loader .slide:before, .typewriter-loader .slide:after,
        .typewriter-loader .slide i:before {
            content: "";
            position: absolute;
            background: var(--tool);
        }

        .typewriter-loader .slide:before {
            width: 2px;
            height: 8px;
            top: 6px;
            left: 100%;
        }

        .typewriter-loader .slide:after {
            left: 94px;
            top: 3px;
            height: 14px;
            width: 6px;
            border-radius: 3px;
        }

        .typewriter-loader .slide i {
            display: block;
            position: absolute;
            right: 100%;
            width: 6px;
            height: 4px;
            top: 4px;
            background: var(--tool);
        }

        .typewriter-loader .slide i:before {
            right: 100%;
            top: -2px;
            width: 4px;
            border-radius: 2px;
            height: 14px;
        }

        .typewriter-loader .paper {
            position: absolute;
            left: 24px;
            top: -26px;
            width: 40px;
            height: 46px;
            border-radius: 5px;
            background: var(--paper);
            transform: translateY(46px);
            -webkit-animation: paper05 var(--duration) linear infinite;
            animation: paper05 var(--duration) linear infinite;
        }

        .typewriter-loader .paper:before {
            content: "";
            position: absolute;
            left: 6px;
            right: 6px;
            top: 7px;
            border-radius: 2px;
            height: 4px;
            transform: scaleY(0.8);
            background: var(--text);
            box-shadow: 0 12px 0 var(--text), 0 24px 0 var(--text), 0 36px 0 var(--text);
        }

        .typewriter-loader .keyboard {
            width: 120px;
            height: 56px;
            margin-top: -10px;
            z-index: 1;
            position: relative;
        }

        .typewriter-loader .keyboard:before, .typewriter-loader .keyboard:after {
            content: "";
            position: absolute;
        }

        .typewriter-loader .keyboard:before {
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            border-radius: 7px;
            background: linear-gradient(135deg, var(--blue), var(--blue-dark));
            transform: perspective(10px) rotateX(2deg);
            transform-origin: 50% 100%;
        }

        .typewriter-loader .keyboard:after {
            left: 2px;
            top: 25px;
            width: 11px;
            height: 4px;
            border-radius: 2px;
            box-shadow: 15px 0 0 var(--key), 30px 0 0 var(--key), 45px 0 0 var(--key), 60px 0 0 var(--key), 75px 0 0 var(--key), 90px 0 0 var(--key), 22px 10px 0 var(--key), 37px 10px 0 var(--key), 52px 10px 0 var(--key), 60px 10px 0 var(--key), 68px 10px 0 var(--key), 83px 10px 0 var(--key);
            -webkit-animation: keyboard05 var(--duration) linear infinite;
            animation: keyboard05 var(--duration) linear infinite;
        }

        @keyframes bounce05 {
            85%, 92%, 100% {
                transform: translateY(0);
            }

            89% {
                transform: translateY(-4px);
            }

            95% {
                transform: translateY(2px);
            }
        }

        @keyframes slide05 {
            5% {
                transform: translateX(14px);
            }

            15%, 30% {
                transform: translateX(6px);
            }

            40%, 55% {
                transform: translateX(0);
            }

            65%, 70% {
                transform: translateX(-4px);
            }

            80%, 89% {
                transform: translateX(-12px);
            }

            100% {
                transform: translateX(14px);
            }
        }

        @keyframes paper05 {
            5% {
                transform: translateY(46px);
            }

            20%, 30% {
                transform: translateY(34px);
            }

            40%, 55% {
                transform: translateY(22px);
            }

            65%, 70% {
                transform: translateY(10px);
            }

            80%, 85% {
                transform: translateY(0);
            }

            92%, 100% {
                transform: translateY(46px);
            }
        }

        @keyframes keyboard05 {
            5%, 12%, 21%, 30%, 39%, 48%, 57%, 66%, 75%, 84% {
                box-shadow: 15px 0 0 var(--key), 30px 0 0 var(--key), 45px 0 0 var(--key), 60px 0 0 var(--key), 75px 0 0 var(--key), 90px 0 0 var(--key), 22px 10px 0 var(--key), 37px 10px 0 var(--key), 52px 10px 0 var(--key), 60px 10px 0 var(--key), 68px 10px 0 var(--key), 83px 10px 0 var(--key);
            }

            9% {
                box-shadow: 15px 2px 0 var(--key), 30px 0 0 var(--key), 45px 0 0 var(--key), 60px 0 0 var(--key), 75px 0 0 var(--key), 90px 0 0 var(--key), 22px 10px 0 var(--key), 37px 10px 0 var(--key), 52px 10px 0 var(--key), 60px 10px 0 var(--key), 68px 10px 0 var(--key), 83px 10px 0 var(--key);
            }

            18% {
                box-shadow: 15px 0 0 var(--key), 30px 0 0 var(--key), 45px 0 0 var(--key), 60px 2px 0 var(--key), 75px 0 0 var(--key), 90px 0 0 var(--key), 22px 10px 0 var(--key), 37px 10px 0 var(--key), 52px 10px 0 var(--key), 60px 10px 0 var(--key), 68px 10px 0 var(--key), 83px 10px 0 var(--key);
            }

            27% {
                box-shadow: 15px 0 0 var(--key), 30px 0 0 var(--key), 45px 0 0 var(--key), 60px 0 0 var(--key), 75px 0 0 var(--key), 90px 0 0 var(--key), 22px 12px 0 var(--key), 37px 10px 0 var(--key), 52px 10px 0 var(--key), 60px 10px 0 var(--key), 68px 10px 0 var(--key), 83px 10px 0 var(--key);
            }

            36% {
                box-shadow: 15px 0 0 var(--key), 30px 0 0 var(--key), 45px 0 0 var(--key), 60px 0 0 var(--key), 75px 0 0 var(--key), 90px 0 0 var(--key), 22px 10px 0 var(--key), 37px 10px 0 var(--key), 52px 12px 0 var(--key), 60px 12px 0 var(--key), 68px 12px 0 var(--key), 83px 10px 0 var(--key);
            }

            45% {
                box-shadow: 15px 0 0 var(--key), 30px 0 0 var(--key), 45px 0 0 var(--key), 60px 0 0 var(--key), 75px 0 0 var(--key), 90px 2px 0 var(--key), 22px 10px 0 var(--key), 37px 10px 0 var(--key), 52px 10px 0 var(--key), 60px 10px 0 var(--key), 68px 10px 0 var(--key), 83px 10px 0 var(--key);
            }

            54% {
                box-shadow: 15px 0 0 var(--key), 30px 2px 0 var(--key), 45px 0 0 var(--key), 60px 0 0 var(--key), 75px 0 0 var(--key), 90px 0 0 var(--key), 22px 10px 0 var(--key), 37px 10px 0 var(--key), 52px 10px 0 var(--key), 60px 10px 0 var(--key), 68px 10px 0 var(--key), 83px 10px 0 var(--key);
            }

            63% {
                box-shadow: 15px 0 0 var(--key), 30px 0 0 var(--key), 45px 0 0 var(--key), 60px 0 0 var(--key), 75px 0 0 var(--key), 90px 0 0 var(--key), 22px 10px 0 var(--key), 37px 10px 0 var(--key), 52px 10px 0 var(--key), 60px 10px 0 var(--key), 68px 10px 0 var(--key), 83px 12px 0 var(--key);
            }

            72% {
                box-shadow: 15px 0 0 var(--key), 30px 0 0 var(--key), 45px 2px 0 var(--key), 60px 0 0 var(--key), 75px 0 0 var(--key), 90px 0 0 var(--key), 22px 10px 0 var(--key), 37px 10px 0 var(--key), 52px 10px 0 var(--key), 60px 10px 0 var(--key), 68px 10px 0 var(--key), 83px 10px 0 var(--key);
            }

            81% {
                box-shadow: 15px 0 0 var(--key), 30px 0 0 var(--key), 45px 0 0 var(--key), 60px 0 0 var(--key), 75px 0 0 var(--key), 90px 0 0 var(--key), 22px 10px 0 var(--key), 37px 12px 0 var(--key), 52px 10px 0 var(--key), 60px 10px 0 var(--key), 68px 10px 0 var(--key), 83px 10px 0 var(--key);
            }
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-800 flex flex-col min-h-screen">

    <div class="container mx-auto px-6 py-12 flex-grow">
        <h2 class="text-3xl font-bold text-[#010132] text-center mb-8">Exp√©rimenter ces prompts</h2>
        <div class="flex-1 bg-white p-8 rounded-2xl shadow-lg flex flex-col max-w-2xl mx-auto">
            <div class="flex-grow">
                <p class="text-slate-600 mb-4">S√©lectionnez une t√¢che pour obtenir un prompt adapt√© que vous pourriez utiliser avec un outil d'IA.</p>
                <!-- Custom Select Component -->
                <div class="relative" id="custom-select-container">
                    <div id="select-selected" class="w-full p-3 border rounded-lg mb-4 transition-all duration-300 flex justify-between items-center cursor-pointer">
                        <span id="select-text">S√©lectionnez une t√¢che...</span>
                        <svg id="select-arrow" class="select-arrow w-5 h-5 text-slate-500" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" />
                        </svg>
                    </div>
                    <div id="select-options" class="hidden absolute top-full left-0 right-0 bg-white border border-t-0 border-slate-300 rounded-b-lg shadow-lg z-10 overflow-hidden">
                        <!-- Options will be populated by JS -->
                    </div>
                </div>
            </div>
            <div>
                <button id="generate-prompt-btn" class="w-full bg-[#49b048] hover:bg-[#3f993e] text-white font-bold py-3 px-4 rounded-lg transition-colors duration-300 disabled:bg-slate-400 flex items-center justify-center" disabled>
                    <span id="btn-text">G√©n√©rer un prompt</span>
                    <span id="btn-emoji" class="hidden ml-2"> ‚ú®</span>
                    <svg id="btn-spinner" class="animate-spin ml-2 h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                    </svg>
                </button>
                <div id="prompt-output" class="mt-6 p-4 bg-slate-100 rounded-lg text-slate-800 hidden"></div>
                <!-- Loading Section with Typewriter -->
                <div id="prompt-loading" class="mt-6 text-center hidden">
                    <div class="flex justify-center items-center py-8">
                         <div class="typewriter-loader">
                            <div class="slide"><i></i></div>
                            <div class="paper"></div>
                            <div class="keyboard"></div>
                        </div>
                    </div>
                    <p id="loading-text" class="text-[#010132] font-semibold">R√©daction en cours...</p>
                </div>
            </div>
        </div>
    </div>

    <footer class="py-8">
        <div class="container mx-auto px-6 text-center">
            <a href="https://lapuce.org" target="_blank" rel="noopener noreferrer" class="inline-block">
                <img src="https://lapuce.org/new/wp-content/uploads/2024/03/cropped-VersionImpression.png" alt="Logo de La Puce Ressource Informatique" class="h-16 mx-auto">
            </a>
        </div>
    </footer>

    <script>
        /**
         * Parses a string for basic Markdown and converts it to HTML.
         * @param {string} text - The text to parse.
         * @returns {string} The HTML-formatted text.
         */
        function parseMarkdown(text) {
            // Convert **bold** to <strong>bold</strong>
            let html = text.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
            // Convert [[placeholder]] to styled code tag
            html = html.replace(/\[\[(.*?)\]\]/g, '<code class="bg-slate-200 text-red-600 font-mono py-1 px-2 rounded-md text-sm">[$1]</code>');
            // Convert newlines to <br>
            html = html.replace(/\n/g, '<br>');
            return html;
        }

        let loadingInterval;

        const allLoadingMessages = [
            "Assemblage des id√©es...",
            "Pr√©paration de la toile...",
            "M√©lange des couleurs...",
            "Touche finale du pinceau...",
            "Votre chef-d'≈ìuvre arrive...",
            "D√©marrage des machines...",
            "Calibration des circuits...",
            "Compilation des donn√©es...",
            "Optimisation de l'algorithme...",
            "G√©n√©ration du r√©sultat...",
            "Consultation de la boule de cristal...",
            "M√©lange des potions...",
            "Invocation des esprits cr√©atifs...",
            "Saupoudrage de poussi√®re d'√©toiles...",
            "La magie op√®re..."
        ];

        /**
         * Shuffles array in place.
         * @param {Array} a items An array containing the items.
         */
        function shuffle(a) {
            for (let i = a.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [a[i], a[j]] = [a[j], a[i]];
            }
            return a;
        }


        async function callGeminiAPI(prompt, outputElement, loadingElement) {
            outputElement.innerHTML = '';
            outputElement.classList.add('hidden');
            loadingElement.classList.remove('hidden');

            const loadingTextElement = document.getElementById('loading-text');
            const shuffledMessages = shuffle([...allLoadingMessages]);
            
            let messageIndex = 0;
            loadingTextElement.textContent = shuffledMessages[messageIndex];
            
            loadingInterval = setInterval(() => {
                messageIndex = (messageIndex + 1) % shuffledMessages.length;
                loadingTextElement.classList.add('is-fading');
                setTimeout(() => {
                    loadingTextElement.textContent = shuffledMessages[messageIndex];
                    loadingTextElement.classList.remove('is-fading');
                }, 500);
            }, 2000);

            const proxyApiUrl = "https://gemini-proxy-notion.michael-araujo.workers.dev/"; 
            
            const payload = { 
                prompt: prompt 
            };

            try {
                const response = await fetch(proxyApiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    throw new Error(`Erreur lors de l'appel au proxy: ${response.statusText}`);
                }
                
                const result = await response.json();
                
                const text = result?.text;
                if (text) {
                    outputElement.innerHTML = parseMarkdown(text);
                    outputElement.classList.remove('hidden');
                } else {
                    throw new Error("R√©ponse invalide de l'API");
                }
            } catch (error) {
                console.error(error);
                outputElement.innerHTML = "D√©sol√©, une erreur est survenue. Veuillez r√©essayer.";
                outputElement.classList.remove('hidden');
            } finally {
                clearInterval(loadingInterval);
                loadingElement.classList.add('hidden');
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            const selectContainer = document.getElementById('custom-select-container');
            const selectedDisplay = document.getElementById('select-selected');
            const selectText = document.getElementById('select-text');
            const selectArrow = document.getElementById('select-arrow');
            const optionsContainer = document.getElementById('select-options');
            
            const generatePromptBtn = document.getElementById('generate-prompt-btn');
            const btnEmoji = document.getElementById('btn-emoji');
            const btnSpinner = document.getElementById('btn-spinner');
            const promptOutput = document.getElementById('prompt-output');
            const promptLoading = document.getElementById('prompt-loading');
            
            let selectedValue = "";

            const options = [
                { value: "", text: "S√©lectionnez une t√¢che..." },
                { value: "r√©diger un courriel de remerciement pour un b√©n√©vole", text: "R√©diger un courriel de remerciement" },
                { value: "r√©sumer un rapport financier annuel", text: "R√©sumer un rapport financier" },
                { value: "cr√©er un plan de communication pour un √©v√©nement", text: "Cr√©er un plan de communication" },
                { value: "brainstormer des id√©es de lev√©e de fonds", text: "Brainstormer des id√©es de lev√©e de fonds" }
            ];

            // Populate options
            options.forEach(option => {
                const optionEl = document.createElement('div');
                optionEl.textContent = option.text;
                optionEl.dataset.value = option.value;
                optionEl.classList.add('p-3', 'cursor-pointer', 'hover:bg-slate-100');
                if (option.value === "") {
                    optionEl.classList.add('text-slate-500');
                }
                optionEl.addEventListener('click', () => {
                    selectText.textContent = option.text;
                    selectedValue = option.value;
                    closeSelect();
                    updateUIState();
                });
                optionsContainer.appendChild(optionEl);
            });

            function closeSelect() {
                optionsContainer.classList.add('hidden');
                selectArrow.classList.remove('select-arrow-up');
            }

            selectedDisplay.addEventListener('click', (e) => {
                e.stopPropagation();
                optionsContainer.classList.toggle('hidden');
                selectArrow.classList.toggle('select-arrow-up');
            });

            window.addEventListener('click', (e) => {
                if (!selectContainer.contains(e.target)) {
                    closeSelect();
                }
            });

            function updateUIState() {
                const isTaskSelected = selectedValue !== '';
                
                generatePromptBtn.disabled = !isTaskSelected;
                
                if (isTaskSelected) {
                    btnEmoji.classList.remove('hidden');
                    btnSpinner.classList.add('hidden');
                } else {
                    btnEmoji.classList.add('hidden');
                    btnSpinner.classList.remove('hidden');
                }
                
                if (isTaskSelected) {
                    selectedDisplay.classList.remove('border-[#49b048]');
                    selectedDisplay.classList.add('border-[#010132]', 'border-2');
                } else {
                    selectedDisplay.classList.remove('border-[#010132]', 'border-2');
                    selectedDisplay.classList.add('border-[#49b048]');
                }
            }
            
            generatePromptBtn.addEventListener('click', () => {
                const selectedOption = options.find(opt => opt.value === selectedValue);
                if (selectedOption) {
                    const taskText = selectedOption.text.toLowerCase();
                    const prompt = `Ta r√©ponse doit commencer par une phrase d'introduction amicale et contextuelle qui varie √† chaque fois. Par exemple : "Voici un prompt que vous pourriez utiliser avec votre agent conversationnel pr√©f√©r√© pour ${taskText} :" ou "Pour vous aider √† ${taskText}, voici une suggestion de prompt :".\n\nEnsuite, r√©dige le prompt lui-m√™me. Ce prompt doit √™tre adapt√© au contexte d'un organisme communautaire (OBNL).\n\nInstructions de formatage pour le prompt que tu g√©n√®res :\n1. Le mot "**Prompt**" doit √™tre en gras (entour√© de double ast√©risques).\n2. Les √©l√©ments que l'utilisateur doit remplacer par ses propres informations doivent √™tre entre doubles crochets, comme ceci : [[√âL√âMENT √Ä COMPL√âTER]].`;
                    callGeminiAPI(prompt, promptOutput, promptLoading);
                }
            });

            updateUIState();
        });
    </script>
</body>
</html>
